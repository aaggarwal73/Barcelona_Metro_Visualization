<!DOCTYPE html>
<html>
  <head>
    <style>
      #map {
        height: 600px;
        width: 100%;
       }

      .ticks {
        font: 10px sans-serif;
      }

      .track,
      .track-inset,
      .track-overlay {
        stroke-linecap: round;
      }

      .track {
        stroke: #000;
        stroke-opacity: 0.3;
        stroke-width: 10px;
      }

      .track-inset {
        stroke: #ddd;
        stroke-width: 8px;
      }

      .track-overlay {
        pointer-events: stroke;
        stroke-width: 50px;
        stroke: transparent;
        cursor: crosshair;
      }

      .handle {
        fill: #fff;
        stroke: #000;
        stroke-opacity: 0.5;
        stroke-width: 1.25px;
      }
    </style>
  </head>
  <body>
    <h3>Maximizing a Day Trip to Barcelona</h3>
    <h3>By: Aman Aggarwal, Chad Gerhard, Matt Lord</h3>
    <div id="map"></div>
    <!-- load the d3.js library -->
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script>
    d3.select("body").append("p").insert("p", ":first-child").append("input")
        .attr("type", "range")
        .attr("min", "10")
        .attr("max", "1000")
        .attr("value", 10)
        .attr("id", "year");
    

    // d3.select("body").insert("h2", ":first-child").text(headline + init_year);

    var color = d3.scaleOrdinal()
    .domain(["L1", "L2", "L3", "L4", "L5", "L6", "L7", "L8", "L9", "L10", "L11"])
    .range(["rgb(225, 57, 62)", "rgb(156, 69, 154)", "rgb(83, 185, 85)", "rgb(254, 189, 16)", "rgb(49, 123, 200)", "rgb(132, 125, 198)", "rgb(174, 97, 24)", "rgb(230, 89, 180)",  "rgb(246, 132, 41)", "rgb(0, 173, 239)", "rgb(168, 209, 100)"])

      function initMap() {
        var barcelona = {lat: 41.366360, lng: 2.175960};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 14,
          center: barcelona
        });
        var marker = new google.maps.Marker({
          position: barcelona,
          map: map
        });
        var transitLayer = new google.maps.TransitLayer();
        transitLayer.setMap(map);

        //puts all of the metro locations on the map.
        //@TODO make it so only one marker per station
        var set = new Set();
        d3.csv('data/barcelona_metro.csv', function(data) {
          data.forEach(function (d) {
            // console.log(set.has(d.name));
            // console.log(d.name);
            if (!set.has(d.name)) {
              var marker = new google.maps.Marker({
                position: new google.maps.LatLng(d.lat, d.lng),
                map: map,
                icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 2,
                  strokeColor : color(d.line)
                }
              });
              var metroInfo = new google.maps.InfoWindow({
                content: d.name
              });

              marker.addListener('click', function() {
                metroInfo.open(map, marker);
              });
              set.add(d.name);

            }


          });
          //draw the attractions, idk why i even set the stroke color to black it's whatever we want it to beeeeee
          d3.csv('data/my-attractions.csv', function(data2) {
          	var count = 0; 

            data2.forEach(function (d2) {
                var newPoint = new google.maps.LatLng(d2.lat, d2.lng);

                data.forEach(function (d) {
                    var metroStation = new google.maps.LatLng(d.lat, d.lng);
                    if (google.maps.geometry.spherical.computeDistanceBetween(metroStation, newPoint) < 1000) {
                        var marker = new google.maps.Marker({
                          position: newPoint,
                          map: map,
                          icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 3,
                            strokeColor : "#000000"
                          }
                      });

                      var info = new google.maps.InfoWindow({
                          content: d2.name
                      });

                      marker.addListener('click', function() {
                          info.open(map, marker);
                      });
                    }
                })
            });
          });

        });


      }
    
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDdRh9dvJMzZi2ucTPzmq3am9sRWyePEww&callback=initMap&libraries=geometry">
    </script>
  </body>
</html>
